# Using the node alpine image to build the React app
image: node:alpine

# Announce the URL as per CRA docs
# https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#advanced-configuration
##variables:
##PUBLIC_URL: /domain
# Cache node modules - speeds up future builds
cache:
  paths:
    - node_modules/
  key: "$CI_REPOSITORY_URL" # no need if not node project

# Name the stages involved in the pipeline
stages:
  - deploy-master
  - deploy-dev

firebaseMas:
  stage: deploy-master
  script:
    # - apk add yarn
    - yarn install # Install all dependencies
    - yarn run build --prod # Build for prod
    #firebase deploy
    - npm install -g firebase-tools
    - firebase use $PROJECT_NAME --token $FIREBASE_TOKEN
    - firebase deploy --only hosting -m "Pipe $CI_PIPELINE_ID Build $CI_BUILD_ID @ Hash ${CI_COMMIT_SHA:0:7} at master"
  only:
    - master # Only run on master branch

firebaseDev:
  stage: deploy-dev
  script:
    # - apk add yarn
    - yarn install # Install all dependencies
    - yarn run build --prod # Build for prod
    #firebase deploy
    - npm install -g firebase-tools
    - firebase use $PROJECT_NAME --token $FIREBASE_TOKEN
    - firebase deploy --only hosting -m "Pipe $CI_PIPELINE_ID Build $CI_BUILD_ID @ Hash ${CI_COMMIT_SHA:0:7} at dev"
  only:
    - development # Only run on development branch
